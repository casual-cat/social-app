{% extends "base.html" %}
{% block content %}
<div class="center-container animated-fade-in profile-container">
  <div class="profile-info">
    {% if user.profile_picture %}
      <img class="profile-picture"
           src="{{ url_for('static', filename='uploads/' ~ user.profile_picture) }}" alt="Profile Pic">
    {% else %}
      <img class="profile-picture"
           src="{{ url_for('static', filename='uploads/default.png') }}" alt="No PFP">
    {% endif %}
    <h2>{{ user.username }}</h2>
    <form method="POST" action="{{ url_for('profile') }}" enctype="multipart/form-data" class="profile-edit-form">
      <label>Change Picture:</label>
      <input type="file" name="profile_picture" accept="image/*">

      <label>Edit Bio:</label>
      <textarea name="bio" rows="2">{{ user.bio or '' }}</textarea>

      <button type="submit" class="btn-primary">Update Profile</button>
    </form>
  </div>
</div>

<!-- Grid of user posts -->
{% set post_count = posts|length %}
<div class="user-posts center-container">
  <h2>{{ post_count }} Posts</h2>
  <div class="post-grid">
    {% for post in posts %}
      <div class="post-tile">
        {% if post.media_filename %}
          {% set post_ext = post.media_filename|lower %}
          {% if post_ext.endswith('.png') or post_ext.endswith('.jpg') or post_ext.endswith('.jpeg') or post_ext.endswith('.gif') %}
            <img class="tile-image" src="{{ url_for('static', filename='uploads/' ~ post.media_filename) }}" alt="Post Media">
          {% elif post_ext.endswith('.mp4') or post_ext.endswith('.mov') or post_ext.endswith('.avi') %}
            <video class="tile-image" src="{{ url_for('static', filename='uploads/' ~ post.media_filename) }}" controls></video>
          {% else %}
            <p>{{ post.content }}</p>
          {% endif %}
        {% else %}
          <p>{{ post.content }}</p>
        {% endif %}
        <p class="tile-likes">{{ post.like_count }} likes</p>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
